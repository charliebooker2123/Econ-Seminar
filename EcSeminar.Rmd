---
title: "Econ Seminar"
author: "Charlie Booker"
date: "May 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(knitr)
library(fs)
library(graphics)
#this library needed to read in excel
library(readxl)
#these libraries will be needed to plot map
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(janitor)
library(kableExtra)
library(dplyr)
library(mapproj)
```

```{r}
#loading in data
patents <- read_excel("Patent_County.xlsx", skip = 1)

#gini coefficient
GC2006 <- read.csv("GC2006-2010.csv")
GC2011 <- read.csv("GC2011-2015.csv")

#per capita income
PCI2006 <- read.csv("PCI2006.csv")
PCI2011 <- read.csv("PCI2010.csv")

#Race
Race2006 <- read.csv("Race2006.csv")
Race2011 <- read.csv("Race2010.csv")

#Education by Sex
Education2006 <- read.csv("EducationSex2006.csv")
Education2011 <- read.csv("EducationSex2010.csv")

#county coordinate data
coordinates <- read_xlsx('County Coordinates.xlsx', skip = 1)

```

```{r}
#editng the data sets
#trimming out unnecessary columns
```


```{r}
#Gini Coefficients edits
#selecting and getting rid of columns
GC2006 <- GC2006 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:J4TM001)

GC2011 <- GC2011 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:AD4BM001)

#renaming Gini Coefficient Columns
GC2006 <- GC2006 %>%
  rename(c("J4TE001" = "GC_Estimate6", "J4TM001" = "GC_Margin_of_Error6"))

GC2011 <- GC2011 %>% 
  rename(c("AD4BE001" = "GC_Estimate11", "AD4BM001" = "GC_Margin_of_Error11"))
```

```{r}
#per capita income edits
#selecting and getting rid of columns
PCI2006 <- PCI2006 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:JQBM001)

PCI2011 <- PCI2011 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:ADOLM001)

#renaming per capita income
PCI2006 <- PCI2006 %>%
  rename(c("JQBE001" = "PCI_Estimate6", "JQBM001" = "PCI_Margin_of_Error6"))

PCI2011 <- PCI2011 %>%
  rename(c("ADOLE001" = "PCI_Estimate11", "ADOLM001" = "PCI_Margin_of_Error11"))
```

```{r}
#Race edits
#selecting and getting rid of columns
Race2006 <- Race2006 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:JMBM010)

Race2011 <- Race2011 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:ADKXM010)

#renaming race
Race2006 <- Race2006 %>%
  rename(c("JMBE001" = "Total_Population6", "JMBE002" = "White6", "JMBE003" = "Black6", "JMBE004" = "Native_American6", "JMBE005" = "Asian6", "JMBE006" = "Pacific6", "JMBE007" = "Some_Other6", "JMBE008" = "Two_or_More6", "JMBE009" = "Two_or_More_Some_Other6", "JMBE010" = "Three_or_More6",
           "JMBM001" = "Total_PopulationErr6", "JMBM002" = "WhiteErr6", "JMBM003" = "BlackErr6", "JMBM004" = "Native_AmericanErr6", "JMBM005" = "AsianErr6", "JMBM006" = "PacificErr6", "JMBM007" = "Some_OtherErr6", "JMBM008" = "Two_or_MoreErr6", "JMBM009" = "Two_or_More_Some_OtherErr6", "JMBM010" = "Three_or_MoreErr6"))

Race2011 <- Race2011 %>%
  rename(c("ADKXE001" = "Total_Population11", "ADKXE002" = "White11", "ADKXE003" = "Black11", "ADKXE004" = "Native_American11", "ADKXE005" = "Asian11", "ADKXE006" = "Pacific11", "ADKXE007" = "Some_Other11", "ADKXE008" = "Two_or_More11", "ADKXE009" = "Two_or_More_Some_Other11", "ADKXE010" = "Three_or_More11",
           "ADKXM001" = "Total_PopulationErr11", "ADKXM002" = "WhiteErr11", "ADKXM003" = "BlackErr11", "ADKXM004" = "Native_AmericanErr11", "ADKXM005" = "AsianErr11", "ADKXM006" = "PacificErr11", "ADKXM007" = "Some_OtherErr11", "ADKXM008" = "Two_or_MoreErr11", "ADKXM009" = "Two_or_More_Some_OtherErr11", "ADKXM010" = "Three_or_MoreErr11"))
```

```{r}
#Education by Sex edits
#selecting and getting rid of columns
Education2006 <- Education2006 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:JN9M035)

Education2011 <- Education2011 %>%
  select(GISJOIN, YEAR, STATE:COUNTYA, NAME_E:ADMYM035)

#renaming Education
Education2006 <- Education2006 %>%
  rename(c("JN9E001" = "Total_Population6", "JN9E002" = "MalePop6", "JN9E003" = "MNoSchool6", "JN9E004" = "M4thGrade6", "JN9E005" = "M5thGrade6", "JN9E006" = "M7thGrade6", "JN9E007" = "M9thGrade6", "JN9E008" = "M10thGrade6", "JN9E009" = "M11thGrade6", "JN9E010" = "M12thGrade6", "JN9E011" = "MHighSchoolGrad6", "JN9E012" = "MSomeCollege16", "JN9E013" = "MSomeCollege1Plus6", "JN9E014" = "MAssociate6", "JN9E015" = "MBachelor6", "JN9E016" = "MMaster6", "JN9E017" = "MProfessional6", "JN9E018" = "MDoctorate6",
           "JN9E019" = "FemalePop6", "JN9E020" = "FNoSchool6", "JN9E021" = "F4thGrade6", "JN9E022" = "F5thGrade6", "JN9E023" = "F7thGrade6", "JN9E024" = "F9thGrade6", "JN9E025" = "F10thGrade6", "JN9E026" = "F11thGrade6", "JN9E027" = "F12thGrade6", "JN9E028" = "FHighSchoolGrad6", "JN9E029" = "FSomeCollege16", "JN9E030" = "FSomeCollege1Plus6", "JN9E031" = "FAssociate6", "JN9E032" = "FBachelor6", "JN9E033" = "FMaster6", "JN9E034" = "FProfessional6", "JN9E035" = "FDoctorate6"))

Education2011 <- Education2011 %>%
  rename(c("ADMYE001" = "Total_Population11", "ADMYE002" = "MalePop11", "ADMYE003" = "MNoSchool11", "ADMYE004" = "M4thGrade11", "ADMYE005" = "M5thGrade11", "ADMYE006" = "M7thGrade11", "ADMYE007" = "M9thGrade11", "ADMYE008" = "M10thGrade11", "ADMYE009" = "M11thGrade11", "ADMYE010" = "M12thGrade11", "ADMYE011" = "MHighSchoolGrad11", "ADMYE012" = "MSomeCollege111", "ADMYE013" = "MSomeCollege1Plus11", "ADMYE014" = "MAssociate11", "ADMYE015" = "MBachelor11", "ADMYE016" = "MMaster11", "ADMYE017" = "MProfessional11", "ADMYE018" = "MDoctorate11",
           "ADMYE019" = "FemalePop11", "ADMYE020" = "FNoSchool11", "ADMYE021" = "F4thGrade11", "ADMYE022" = "F5thGrade11", "ADMYE023" = "F7thGrade11", "ADMYE024" = "F9thGrade11", "ADMYE025" = "F10thGrade11", "ADMYE026" = "F11thGrade11", "ADMYE027" = "F12thGrade11", "ADMYE028" = "FHighSchoolGrad11", "ADMYE029" = "FSomeCollege111", "ADMYE030" = "FSomeCollege1Plus11", "ADMYE031" = "FAssociate11", "ADMYE032" = "FBachelor11", "ADMYE033" = "FMaster11", "ADMYE034" = "FProfessional11", "ADMYE035" = "FDoctorate11"))
```

```{r}
#editing the coordinates data set
#renaming the columns
coordinates <- coordinates %>%
  rename(c("X__1" = "Sort", "X__2" = "State", "X__3" = "FIPS", "X__4" = "County", "X__5" = "CountySeats", "-2010" = "Population", "Longitude1" = "Longitude", "Latitude1" = "Latitude"))

#getting rid of unneeded columns 
coordinates <- coordinates %>%
  select(Sort, State, FIPS, County, Population, Longitude, Latitude)
  
```

```{r}
#capitalizing the state name so I can merge by state name
Education2006[,3] = toupper(Education2006[,3])
Education2011[,3] = toupper(Education2011[,3])

GC2006[,3] = toupper(GC2006[,3])
GC2011[,3] = toupper(GC2011[,3])

PCI2006[,3] = toupper(PCI2006[,3])
PCI2011[,3] = toupper(PCI2011[,3])

Race2006[,3] = toupper(Race2006[,3])
Race2011[,3] = toupper(Race2011[,3])


```

```{r}
#renaming a few patent variables, preparing for easier merger by changing FIPS name
patents <- patents %>%
  rename(c('Regional Area Component' = "County", 'FIPS Code' = "FIPS"))
```

```{r}
#getting rid of parentheses in the County column
patents$CountyNew1 <-
gsub("\\s*\\([^\\)]+\\)","",as.character(patents$County))

patents$County <- patents$CountyNew1
```


```{r}
#library(tm)

#stopwords = c("[()]", "", "city")
#stopwords = readLines('stopwords.txt')
#x = patents$County
#x = removeWords(x,stopwords)

#patents$County_new <- x

#patents <-  patents %>%
  #str_remove_all("(city)")
```

```{r}
#first merger with coordinates and patents

pat_coord <- inner_join(patents, coordinates, by = "FIPS")
#renaming variables in set so it can merge
pat_coord <- pat_coord %>%
  rename(c("State" = "Abbreviation", 'State or Territory' = "STATE", "County.x" = "COUNTY"))

#merging patent and coordinates data set with gini coefficient

gcpcoord <- inner_join(pat_coord, GC2006, by = c("STATE", "COUNTY"))
```

```{r}
#merging all sets
all <- inner_join(gcpcoord, GC2011, by = c("STATE", "COUNTY")) %>%
  inner_join(., Race2006, by = c("STATE", "COUNTY")) %>%
  inner_join(., Race2011, by = c("STATE", "COUNTY")) %>%
  inner_join(., PCI2006, by = c("STATE", "COUNTY")) %>%
  inner_join(., PCI2011, by = c("STATE", "COUNTY")) %>%
  inner_join(., Education2006, by = c("STATE", "COUNTY")) %>%
  inner_join(., Education2011, by = c("STATE", "COUNTY")) 
  
```

```{r}
#editing the all data set and cutting out columns
#not including all the extra mixed races
new_all <- all %>%
  select(FIPS:Total, Abbreviation, Longitude, Latitude, GC_Estimate6, GC_Margin_of_Error6, GC_Estimate11, GC_Margin_of_Error11, Total_Population6.x:Pacific6,)
```

